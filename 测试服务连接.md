# 测试服务连接

## 服务状态
✅ 服务正在运行（active (running)）
✅ 4个worker进程已启动
✅ 监听在 127.0.0.1:5000

## 测试步骤

### 1. 检查端口监听

```bash
sudo netstat -tlnp | grep 5000
```

**应该看到：**
```
tcp  0  0  127.0.0.1:5000  0.0.0.0:*  LISTEN  9261/python3
```

### 2. 测试后端API（直接连接）

```bash
curl http://127.0.0.1:5000/api/health
```

**应该返回JSON：**
```json
{"status":"ok","message":"PPT图片增强服务运行正常",...}
```

### 3. 测试通过Nginx访问

```bash
curl http://127.0.0.1/api/health
```

**应该返回相同的JSON响应**

### 4. 测试HTTPS（如果已配置）

```bash
curl https://www.rancho.website/api/health
```

### 5. 检查Nginx错误日志

```bash
# 查看最新错误（应该没有新的连接拒绝错误）
sudo tail -10 /var/log/nginx/error.log
```

## 如果测试失败

### 问题1：端口5000未监听

```bash
# 检查进程
ps aux | grep gunicorn | grep -v grep

# 如果进程不存在，重启服务
sudo systemctl restart ppt-enhancer
sudo systemctl status ppt-enhancer
```

### 问题2：API返回错误

```bash
# 查看详细日志
sudo journalctl -u ppt-enhancer -f

# 在另一个终端测试
curl -v http://127.0.0.1:5000/api/health
```

### 问题3：Nginx无法连接

```bash
# 检查Nginx配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx

# 检查Nginx状态
sudo systemctl status nginx
```

## 完整测试脚本

运行以下命令进行完整测试：

```bash
echo "=== 1. 检查端口监听 ==="
sudo netstat -tlnp | grep 5000
echo ""

echo "=== 2. 测试后端API ==="
curl -s http://127.0.0.1:5000/api/health | head -c 200
echo ""
echo ""

echo "=== 3. 测试Nginx代理 ==="
curl -s http://127.0.0.1/api/health | head -c 200
echo ""
echo ""

echo "=== 4. 检查Nginx错误 ==="
sudo tail -5 /var/log/nginx/error.log
echo ""

echo "=== 5. 检查服务状态 ==="
sudo systemctl status ppt-enhancer --no-pager | head -10
```

## 验证网站访问

如果所有测试通过，在浏览器中访问：
- `https://www.rancho.website/`
- `https://www.rancho.website/api/health`

应该能正常加载！

